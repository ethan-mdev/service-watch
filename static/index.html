<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Watch API</title>
    <style>
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            background: #0d1117;
            color: #c9d1d9;
        }
        h1 { 
            color: #58a6ff;
            border-bottom: 1px solid #21262d;
            padding-bottom: 1rem;
        }
        h2 { 
            color: #58a6ff;
            border-bottom: 1px solid #21262d;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        h3 { color: #8b949e; }
        a { color: #58a6ff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        code {
            background: #161b22;
            color: #e6edf3;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        pre {
            background: #0d1117;
            color: #e6edf3;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid #30363d;
        }
        pre code {
            background: transparent;
            color: inherit;
        }
        .endpoint {
            background: #161b22;
            border-left: 4px solid #1f6feb;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            border: 1px solid #30363d;
        }
        .method {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-weight: bold;
            font-size: 0.85em;
            margin-right: 0.5rem;
        }
        .get { background: #1f6feb; color: #ffffff; }
        .post { background: #238636; color: #ffffff; }
        .put { background: #d29922; color: #000000; }
        .delete { background: #da3633; color: #ffffff; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #21262d;
        }
        th {
            background: #161b22;
            font-weight: 600;
            color: #8b949e;
        }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: #1f6feb;
            color: #ffffff;
            border-radius: 3px;
            font-size: 0.85em;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        p { color: #8b949e; }
        strong { color: #c9d1d9; }
        ul, ol { color: #8b949e; }
        footer { 
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #21262d;
            color: #6e7681;
        }
    </style>
</head>
<body>
    <h1>Service Watch API Documentation</h1>
    <p>REST API for Windows service monitoring and management.</p>
    <p><strong>Base URL:</strong> <code>http://localhost:8080</code></p>

    <h2>Services</h2>
    <p>Manage and query Windows services.</p>

    <div class="endpoint">
        <h3><span class="method get">GET</span> /v1/services</h3>
        <p>List all Windows services.</p>
        <p><strong>Response:</strong></p>
        <pre><code>{
  "items": [
    {
      "name": "Spooler",
      "displayName": "Print Spooler",
      "state": "running",
      "startType": "auto"
    }
  ]
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method get">GET</span> /v1/services/{name}</h3>
        <p>Get detailed information about a specific service including CPU, memory, and uptime.</p>
        <p><strong>Example:</strong> <code>GET /v1/services/Spooler</code></p>
        <p><strong>Response:</strong></p>
        <pre><code>{
  "name": "Spooler",
  "displayName": "Print Spooler",
  "state": "running",
  "startType": "auto",
  "canStop": true,
  "pid": 1234,
  "cpuPercent": 0.5,
  "memoryMB": 12.3,
  "uptimeSeconds": 86400
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> /v1/services/{name}/start</h3>
        <p>Start a stopped service.</p>
        <p><strong>Example:</strong> <code>POST /v1/services/Spooler/start</code></p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> /v1/services/{name}/stop</h3>
        <p>Stop a running service.</p>
        <p><strong>Example:</strong> <code>POST /v1/services/Spooler/stop</code></p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> /v1/services/{name}/restart</h3>
        <p>Restart a service (stop then start).</p>
        <p><strong>Example:</strong> <code>POST /v1/services/Spooler/restart</code></p>
    </div>

    <h2>Watchlist</h2>
    <p>Manage services to monitor for auto-restart.</p>

    <div class="endpoint">
        <h3><span class="method get">GET</span> /v1/watchlist</h3>
        <p>List all watchlist items with current service details.</p>
        <p><strong>Response:</strong></p>
        <pre><code>{
  "items": [
    {
      "serviceName": "Spooler",
      "autoRestart": true,
      "restartCount": 3,
      "lastRestart": "2025-11-04T12:34:56Z",
      "service": {
        "name": "Spooler",
        "displayName": "Print Spooler",
        "state": "running",
        "cpuPercent": 0.5,
        "memoryMB": 12.3
      }
    }
  ]
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method get">GET</span> /v1/watchlist/{name}</h3>
        <p>Get a specific watchlist item with current service details.</p>
        <p><strong>Example:</strong> <code>GET /v1/watchlist/Spooler</code></p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> /v1/watchlist</h3>
        <p>Add a service to the watchlist.</p>
        <p><strong>Request Body:</strong></p>
        <pre><code>{
  "serviceName": "Spooler",
  "autoRestart": true
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span> /v1/watchlist/{name}</h3>
        <p>Update auto-restart setting for a watchlist item.</p>
        <p><strong>Request Body:</strong></p>
        <pre><code>{
  "autoRestart": false
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method delete">DELETE</span> /v1/watchlist/{name}</h3>
        <p>Remove a service from the watchlist.</p>
        <p><strong>Example:</strong> <code>DELETE /v1/watchlist/Spooler</code></p>
    </div>

    <h2>Metrics</h2>
    <p>Query historical log data.</p>

    <div class="endpoint">
        <h3><span class="method get">GET</span> /v1/metrics</h3>
        <p>Query log entries with optional filters.</p>
        
        <p><strong>Query Parameters:</strong></p>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>event</code></td>
                    <td>Filter by event type</td>
                    <td><code>metric_sample</code>, <code>restart_success</code></td>
                </tr>
                <tr>
                    <td><code>service</code></td>
                    <td>Filter by service name</td>
                    <td><code>Spooler</code></td>
                </tr>
                <tr>
                    <td><code>limit</code></td>
                    <td>Max results (default: 100)</td>
                    <td><code>50</code></td>
                </tr>
                <tr>
                    <td><code>since</code></td>
                    <td>Duration or timestamp</td>
                    <td><code>1h</code>, <code>30m</code>, <code>2025-11-04T12:00:00Z</code></td>
                </tr>
            </tbody>
        </table>

        <p><strong>Example Queries:</strong></p>
        <pre><code># Last 100 metric samples
GET /v1/metrics?event=metric_sample&limit=100

# Last hour of metrics for specific service
GET /v1/metrics?event=metric_sample&service=Spooler&since=1h

# All restart events in last 24 hours
GET /v1/metrics?event=restart_success&since=24h

# All errors
GET /v1/metrics?level=ERROR&limit=50</code></pre>

        <p><strong>Response:</strong></p>
        <pre><code>{
  "count": 2,
  "items": [
    {
      "time": "2025-11-04T12:34:56Z",
      "level": "INFO",
      "event": "metric_sample",
      "data": {
        "serviceName": "Spooler",
        "cpuPercent": 0.5,
        "memoryMB": 12.3,
        "state": "running"
      }
    }
  ]
}</code></pre>
    </div>

    <h2>Events (SSE)</h2>
    <p>Real-time event stream using Server-Sent Events.</p>

    <div class="endpoint">
        <h3><span class="method get">GET</span> /v1/events</h3>
        <p>Subscribe to real-time events via Server-Sent Events.</p>
        
        <p><strong>Event Types:</strong></p>
        <ul>
            <li><span>host_resources</span> - Host metrics (CPU, memory)</li>
            <li><span>restart_attempt</span> - Service restart initiated</li>
            <li><span>restart_success</span> - Service restarted successfully</li>
            <li><span>restart_failed</span> - Service restart failed</li>
            <li><span>service_failed</span> - Service exceeded max restart attempts</li>
            <li><span>app_started</span> - Application started</li>
            <li><span>watcher_started</span> - Service monitor started</li>
        </ul>
    </div>

    <h2>Common Use Cases</h2>

    <h3>Monitor Service Health</h3>
    <pre><code># Add to watchlist with auto-restart
curl -X POST http://localhost:8080/v1/watchlist \
  -H "Content-Type: application/json" \
  -d '{"serviceName":"Spooler","autoRestart":true}'

# Watch live events
curl -N http://localhost:8080/v1/events</code></pre>

    <h3>View Historical Metrics</h3>
    <pre><code># Get last hour of CPU/memory data for a service
curl "http://localhost:8080/v1/metrics?event=service_status&service=Spooler&since=1h"</code></pre>

    <h3>Manual Service Control</h3>
    <pre><code># Stop service
curl -X POST http://localhost:8080/v1/services/Spooler/stop

# Check status
curl http://localhost:8080/v1/services/Spooler

# Start service
curl -X POST http://localhost:8080/v1/services/Spooler/start</code></pre>

    <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e5e7eb; color: #6b7280;">
        <p>Service Watch - Windows Service Monitoring API</p>
    </footer>
</body>
</html>
